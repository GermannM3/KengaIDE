# BLOCK 20 ‚Äî Stability & Polish

## –¶–µ–ª—å
–ò–∑ ¬´—Ä–∞–±–æ—Ç–∞–µ—Ç¬ª ‚Üí ¬´–º–æ–∂–Ω–æ –¥–∞–≤–∞—Ç—å –ª—é–¥—è–º¬ª. –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ pre-alpha Cursor.

---

## 20.1 ‚Äî Agent Guardrails (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

**–¶–µ–ª—å:** –∞–≥–µ–Ω—Ç –ù–ï –ú–û–ñ–ï–¢ –º–æ–ª—á–∞ —Ç—É–ø–∏—Ç—å –∏–ª–∏ –ø–æ—Ä—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- `max_steps` (turns) ‚Äî —É–∂–µ –µ—Å—Ç—å, —É—Å–∏–ª–∏—Ç—å
- `max_tokens_generated` ‚Äî –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞ —Å–µ—Å—Å–∏—é
- `max_time_ms` ‚Äî —Ç–∞–π–º–∞—É—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –î–µ—Ç–µ–∫—Ç–æ—Ä—ã:
  - –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è tool_call (—É–∂–µ –µ—Å—Ç—å)
  - –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥ (N —Ä–∞–∑)
  - –ø—É—Å—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –º–æ–¥–µ–ª–∏

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ
- –ê–≥–µ–Ω—Ç –∑–∞—Ü–∏–∫–ª–∏–ª—Å—è ‚Üí –∞–≤—Ç–æ-stop
- UI: ¬´–ê–≥–µ–Ω—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –¥–µ–π—Å—Ç–≤–∏—è. –ü–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É.¬ª

---

## 20.2 ‚Äî Agent Reasoning Visibility

### Timeline UI
- üß† Thinking
- üõ† Tool call
- üìÑ File changed
- ‚ö† Error
- ‚úÖ Done
- –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–æ, —Å–≤—è–∑—å —Å —Ñ–∞–π–ª–∞–º–∏

---

## 20.3 ‚Äî Retry & Recovery

### –ö–Ω–æ–ø–∫–∏
- üîÅ Retry last step
- ‚Ü© Rollback changes
- üß™ Run again with more context

### –•—Ä–∞–Ω–µ–Ω–∏–µ
- –ø–æ—Å–ª–µ–¥–Ω–∏–π prompt
- tool_results
- —Å–ø–∏—Å–æ–∫ –ø–∞—Ç—á–µ–π (path, before, after) –¥–ª—è rollback

---

## 20.4 ‚Äî Model Quality Control

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- –í agent mode –æ—Ç–≤–µ—Ç –æ–±—è–∑–∞–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å tool_call –∏–ª–∏ —è–≤–Ω—ã–π DONE
- –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∞–≤—Ç–æ-reprompt: ¬´You must either call a tool or explicitly finish.¬ª

---

## 20.5 ‚Äî First Run Experience

### Welcome flow
1. Welcome
2. –ß—Ç–æ —Ö–æ—á–µ—à—å? –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç / –û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É
3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –º–æ–¥–µ–ª—å (DeepSeek)
4. ¬´–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç¬ª

---

## 20.6 ‚Äî Telemetry & Debug Mode

### –õ–æ–≥–∏
- `.kengaide/logs/agent.log`
- `.kengaide/logs/mcp.log`
- `.kengaide/logs/runtime.log`

### –ö–æ–º–∞–Ω–¥–∞
- Toggle Debug Mode (Command Palette)
